<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Mizu Pay Extension</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .debug-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .debug-header h1 {
            color: #333;
            margin-bottom: 10px;
        }
        .debug-section {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .debug-section h3 {
            color: #1976d2;
            margin-top: 0;
        }
        .debug-button {
            background: linear-gradient(135deg, #00D4AA 0%, #00A8CC 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
        }
        .debug-button:hover {
            transform: translateY(-2px);
        }
        .debug-button.danger {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }
        .debug-button.success {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        .status.success {
            background: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        .status.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        .status.info {
            background: #e3f2fd;
            color: #1976d2;
            border: 1px solid #2196f3;
        }
        .code-block {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="debug-container">
        <div class="debug-header">
            <h1>ðŸ”§ Mizu Pay Extension Debug</h1>
            <p>Debug and fix extension redirection issues</p>
        </div>

        <div class="debug-section">
            <h3>Current Extension Status</h3>
            <button class="debug-button" onclick="checkExtensionStatus()">Check Status</button>
            <div id="statusOutput"></div>
        </div>

        <div class="debug-section">
            <h3>Fix Redirection Issues</h3>
            <p>If the extension is still redirecting to the old URL, use these buttons:</p>
            <button class="debug-button danger" onclick="clearAllStorage()">Clear All Storage</button>
            <button class="debug-button success" onclick="setLocalhostUrl()">Set Localhost URL</button>
            <button class="debug-button" onclick="reloadExtension()">Reload Extension</button>
        </div>

        <div class="debug-section">
            <h3>Test Extension</h3>
            <p>Test the extension with a simulated checkout:</p>
            <button class="debug-button" onclick="openTestCheckout()">Open Test Checkout</button>
            <button class="debug-button" onclick="simulateCheckout()">Simulate Checkout Detection</button>
        </div>

        <div class="debug-section">
            <h3>Manual Storage Commands</h3>
            <p>Run these commands in the browser console if needed:</p>
            <div class="code-block">
// Clear extension storage
chrome.storage.sync.clear();
chrome.storage.local.clear();

// Set localhost URL
chrome.storage.sync.set({
  enabled: true,
  showFloatingButton: true,
  mizuPayUrl: 'http://localhost:3000/payment'
});

// Reload extension
chrome.runtime.reload();
            </div>
        </div>
    </div>

    <script>
        function showStatus(message, type = 'info') {
            const output = document.getElementById('statusOutput');
            output.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function checkExtensionStatus() {
            if (typeof chrome === 'undefined' || !chrome.storage) {
                showStatus('Chrome extension API not available. Make sure you\'re running this in a Chrome extension context.', 'error');
                return;
            }

            chrome.storage.sync.get(['enabled', 'showFloatingButton', 'mizuPayUrl'], (result) => {
                const status = `
                    <strong>Extension Settings:</strong><br>
                    Enabled: ${result.enabled !== false}<br>
                    Show Floating Button: ${result.showFloatingButton !== false}<br>
                    Mizu Pay URL: ${result.mizuPayUrl || 'Not set (will use default)'}
                `;
                showStatus(status, 'info');
            });
        }

        function clearAllStorage() {
            if (typeof chrome === 'undefined' || !chrome.storage) {
                showStatus('Chrome extension API not available.', 'error');
                return;
            }

            chrome.storage.sync.clear(() => {
                chrome.storage.local.clear(() => {
                    showStatus('All extension storage cleared successfully!', 'success');
                });
            });
        }

        function setLocalhostUrl() {
            if (typeof chrome === 'undefined' || !chrome.storage) {
                showStatus('Chrome extension API not available.', 'error');
                return;
            }

            chrome.storage.sync.set({
                enabled: true,
                showFloatingButton: true,
                mizuPayUrl: 'http://localhost:3000/payment'
            }, () => {
                showStatus('Localhost URL set successfully! Extension will now redirect to localhost:3000/payment', 'success');
            });
        }

        function reloadExtension() {
            if (typeof chrome === 'undefined' || !chrome.runtime) {
                showStatus('Chrome extension API not available.', 'error');
                return;
            }

            chrome.runtime.reload();
            showStatus('Extension reloaded! Please refresh this page.', 'success');
        }

        function openTestCheckout() {
            window.open('./test-checkout.html', '_blank');
        }

        function simulateCheckout() {
            // Simulate checkout detection by dispatching a custom event
            const event = new CustomEvent('mizu-pay-checkout-detected', {
                detail: {
                    storeName: 'Test Store',
                    amount: 55.97,
                    country: 'US',
                    description: 'Test Products',
                    url: window.location.href
                }
            });
            document.dispatchEvent(event);
            showStatus('Checkout simulation dispatched. Check if floating button appears.', 'info');
        }

        // Auto-check status on page load
        window.addEventListener('load', () => {
            setTimeout(checkExtensionStatus, 1000);
        });
    </script>
</body>
</html>
